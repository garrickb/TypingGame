var canvas=document.getElementById("game");var ctx=canvas.getContext("2d");var infoCanvas=document.getElementById("gameInfo");var ctxInfo=infoCanvas.getContext("2d");canvas.width=800;canvas.height=600;infoCanvas.width=800;infoCanvas.height=100;window.requestAnimationFrame(run);ScreenEnum={MainMenu:0,Game:1,Inventory:2,Store:3};var activeScreen=ScreenEnum.Game;var focus=true;var tickTime=0;var tickRate=0.05;var speedMod=0.65;var time=Date.now();var imgScale=2.5;var player={health:100,damage:6,exp:0,gold:0};var currentWord="";var bgObj=new Image();bgObj.width=800;bgObj.height=600;canvas.addEventListener("click",onGameClick,false);infoCanvas.addEventListener("click",onInfoClick,false);var activeMonster;document.onkeypress=function(a){if(focus){if(a.keyCode==13){currentWord="";activeMonster=undefined}else{currentWord+=String.fromCharCode(a.keyCode)}getMonster()}};document.onkeydown=function(a){if(focus){if(a.keyCode==8){currentWord=currentWord.substr(0,currentWord.length-1);if(currentWord.length==0){activeMonster=undefined}return false}}return true};window.onblur=function(){focus=false};document.onblur=window.onblur;function onGameClick(a){if(focus){if(Math.floor(Math.random()*2)==0){currentLevel.addMonster(new Monster(1,a.clientX,a.clientY))}else{currentLevel.addMonster(new Monster(2,a.clientX,a.clientY))}}}function onInfoClick(a){if(focus){if(a.clientX>740&&a.clientY>700){focus=false}}else{focus=true}}var currentLevel;var loadedMonsters=[];AttributeEnum={NAME:0,SRC:1,HP:2,MOVE_SPEED:3,ATTK_SPEED:4,DAMAGE:5,EXP:6,GOLD:7};function Monster(b,a,d){this.difficulty=b;this.attributes=getAttributes(b);if(loadedMonsters[this.attributes[AttributeEnum.SRC]]==undefined){var c=new Image();c.src=this.attributes[AttributeEnum.SRC];loadedMonsters[this.attributes[AttributeEnum.SRC]]=c}this.width=loadedMonsters[this.attributes[AttributeEnum.SRC]].width*imgScale;this.height=loadedMonsters[this.attributes[AttributeEnum.SRC]].height*imgScale;this.x=a-(this.height/2);this.y=d;this.startX=this.x;this.currentHP=this.attributes[AttributeEnum.HP];this.destX=this.x;this.destY=600-(this.height/2);this.word=getWord(b);if(activeMonster==undefined){getMonster()}}Monster.prototype.hit=function(){if(this==activeMonster){activeMonster=undefined}this.currentHP-=player.damage;if(this.currentHP>0){this.word=getWord(this.difficulty)}};Monster.prototype.kill=function(){player.exp+=this.attributes[AttributeEnum.EXP];player.gold+=this.attributes[AttributeEnum.GOLD];this.destroy()};Monster.prototype.destroy=function(){if(currentLevel!=undefined&&currentLevel.monsters!=undefined){if(this==activeMonster){activeMonster=undefined}currentLevel.monsters.splice(currentLevel.monsters.indexOf(this),1)}};Monster.prototype.update=function(){if(this.currentHP<=0){this.kill();return}var a=this.destX-this.x;var b=this.destY-this.y;var c=this.attributes[AttributeEnum.MOVE_SPEED];if(b!=0){if(a>0){this.x+=((a>c/2*speedMod)?c/2*speedMod:a)}else{if(a<0){this.x-=((a<c/2*speedMod)?c/2*speedMod:-a)}else{if(Math.random()*100>96){this.destX=this.startX-150+Math.random()*300;if(this.destX>=800){this.destX=799}else{if(this.destX<=0){this.destX=1}}}}}}if(b>0){this.y+=c*speedMod}else{this.y=this.destY}};Monster.prototype.draw=function(){if(this.width==0){var a=new Image();a.src=this.attributes[AttributeEnum.SRC];loadedMonsters[this.attributes[AttributeEnum.SRC]]=a;this.width=loadedMonsters[this.attributes[AttributeEnum.SRC]].width*imgScale;this.height=loadedMonsters[this.attributes[AttributeEnum.SRC]].height*imgScale}if(this.currentHP>0){var b=loadedMonsters[this.attributes[AttributeEnum.SRC]];ctx.drawImage(b,this.x-this.width/2,this.y-this.height/2,this.width,this.height);ctx.beginPath();ctx.fillStyle="green";ctx.rect(this.x-this.width/2,this.y-this.height/2-5,(this.currentHP/this.attributes[AttributeEnum.HP])*this.width,15);ctx.fill();ctx.lineWidth=2;ctx.strokeStyle="black";ctx.stroke();ctx.beginPath();ctx.fillStyle="red";ctx.rect(this.x-this.width/2+(this.currentHP/this.attributes[AttributeEnum.HP])*this.width,this.y-this.height/2-5,this.width-((this.currentHP/this.attributes[AttributeEnum.HP])*this.width),15);ctx.fill();ctx.lineWidth=2;ctx.strokeStyle="black";ctx.stroke()}};Monster.prototype.drawWord=function(){if(this.currentHP>0){var g="25pt MarkerFelt-Thin, Comic Sans MS";var b="20pt MarkerFelt-Thin, Comic Sans MS";var f=0;var j=(this.x>(ctx.measureText(this.word).width/2)+10)?((this.x<790+(ctx.measureText(this.word).width/2)-ctx.measureText(this.word).width)?this.x-(ctx.measureText(this.word).width/2):790-ctx.measureText(this.word).width):10;var h=this.y-17-this.height/2;if(activeMonster==this){var d=wordCorrectness();for(var e=0;e<2;e++){ctx.font=g;ctx.fillStyle="green";for(var c=0;c<d[0].length;c++){var a=d[0].charAt(c);if(e==0){f+=ctx.measureText(a).width}else{ctx.fillText(a,j,h);j+=ctx.measureText(a).width}}ctx.font=b;ctx.fillStyle="black";for(c=0;c<d[1].length;c++){a=d[1].charAt(c);if(e==0){f+=ctx.measureText(a).width}else{ctx.fillText(a,j,h);j+=ctx.measureText(a).width}}if(e==0){drawRect(j,h,35,f);ctx.fillStyle="black"}}ctx.font="20pt MarkerFelt-Thin, Comic Sans MS"}else{drawRect(j,h,35,ctx.measureText(this.word).width);ctx.fillText(this.word,j,h)}}};LevelDataEnum={BG_SRC:0,DIFFICULTY:1,ENEMY_LEVELS:2,BASE_TICKS:3,MAX_TICKS:4,ON_START:5,ON_FINISH:6,REWARD_EXP:7,REWARD_GOLD:8};var levels=[["resources/img/room/room1.png",12,[0],50,25,function(){},function(){alert("level 1 ended: rewarded 50 gold and 10 exp")},50,10],["resources/img/room/room1.png",25,[0,1,1,1],45,25,function(){alert("omg lvl2 git rdy")},function(){alert("level 2 ended: rewarded 100 exp and 25 gold")},100,25],["resources/img/room/room1.png",25,[0,1,1,2,2,2],45,20,function(){},function(){alert("level 3 ended: rewarded 200 exp and 50 gold")},200,50]];var levelIndex=0;function Level(b){currentLevel=this;this.currentDifficulty=0;this.monsters=[];this.active=false;this.data=b;var a=new Image();a.src=b[LevelDataEnum.BG_SRC];a.onload=function(){bgObj=a;b[LevelDataEnum.ON_START]();currentLevel.active=true}}Level.prototype.addMonster=function(a){if(a instanceof Monster){this.monsters.push(a)}};Level.prototype.end=function(){this.active=false;player.gold+=this.data[LevelDataEnum.REWARD_GOLD];player.exp+=this.data[LevelDataEnum.REWARD_EXP];this.data[LevelDataEnum.ON_FINISH]();if(++levelIndex<levels.length){currentLevel=new Level(levels[levelIndex])}else{currentLevel=undefined;alert("no more levels to load")}};function drawRect(b,e,a,d){var c=d+10;ctx.fillStyle="white";ctx.lineWidth=5;ctx.strokeStyle="black";ctx.beginPath();ctx.moveTo(b-5+5,e-28);ctx.lineTo(b-5+c-5,e-28);ctx.quadraticCurveTo(b-5+c,e-28,b-5+c,e-28+5);ctx.lineTo(b-5+c,e-28+a-5);ctx.quadraticCurveTo(b-5+c,e-28+a,b-5+c-5,e-28+a);ctx.lineTo(b-5+5,e-28+a);ctx.quadraticCurveTo(b-5,e-28+a,b-5,e-28+a-5);ctx.lineTo(b-5,e-28+5);ctx.quadraticCurveTo(b-5,e-28,b-5+5,e-28);ctx.closePath();ctx.stroke();ctx.fill();ctx.fillStyle="black"}function getAttributes(b){var c=new Array(8);var e;var f=-1;var g;var a=0;switch(b){case 0:e=[["Slime",["resources/img/monster/LivingMoundGreen.PNG","resources/img/monster/LivingMoundGreenBrown.PNG","resources/img/monster/LivingMoundMagenta.PNG","resources/img/monster/LivingMoundOrange.PNG","resources/img/monster/LivingMoundTeal.PNG"],5,6,5,5]];f=0;g=2;if(Math.floor(Math.random()*100)>65){a=Math.floor(Math.random()*3)+1}break;case 1:e=[["Slime",["resources/img/monster/LivingMoundGreen.PNG","resources/img/monster/LivingMoundGreenBrown.PNG","resources/img/monster/LivingMoundMagenta.PNG","resources/img/monster/LivingMoundOrange.PNG","resources/img/monster/LivingMoundTeal.PNG"],10,5,4,5],["Bat",["resources/img/monster/BatBrown.PNG"],5,7,2,4],["Centipede",["resources/img/monster/CentipedeBlue.PNG","resources/img/monster/CentipedeBrown.PNG","resources/img/monster/CentipedeGreenDark.PNG","resources/img/monster/CentipedeGrey.PNG","resources/img/monster/CentipedePink.PNG","resources/img/monster/CentipedeRed.PNG","resources/img/monster/CentipedeSilver.PNG"],12,4,4,7]];f=Math.floor(Math.random()*e.length);g=5;if(Math.floor(Math.random()*100)>50){a=Math.floor(Math.random()*5)+1}break;case 2:e=[["Spiky Slime",["resources/img/monster/LivingMoundBrown.PNG","resources/img/monster/LivingMoundBrownGreen.PNG","resources/img/monster/LivingMoundFlesh.PNG","resources/img/monster/LivingMoundLightGreen.PNG","resources/img/monster/LivingMoundRed.PNG"],20,4,4,8],["Tentacle Centipede",["resources/img/monster/CentipedeBlueTentacles.PNG","resources/img/monster/CentipedeGreenTentacles.PNG","resources/img/monster/CentipedeGreenTentacles2.PNG","resources/img/monster/CentipedeRedTentacles.PNG"],16,7,4,14]];f=Math.floor(Math.random()*e.length);g=5;if(Math.floor(Math.random()*100)>35){a=Math.floor(Math.random()*7)+2}break;default:console.error("THIS MONSTER DIFFICULTY IS NOT YET SUPPORTED! ["+b+"]");break}for(var d=0;d<8;d++){switch(d){case 1:c[d]=e[f][d][Math.floor(Math.random()*e[f][d].length)];break;case 6:c[d]=g;break;case 7:c[d]=a;break;default:c[d]=e[f][d];break}}return c}function getWord(a){var b=[currentLevel.monsters.length];for(var c=0;c<currentLevel.monsters.length;c++){if(currentLevel.monsters[c].word!==undefined){b[c]=currentLevel.monsters[c].word[0]}}var f;switch(a){case 0:f=["a","at","bat","cat","rat","sat","an","can","fan","man","pan","cap","map","nap","tap","bag","wag","nap","tap","rag","am","jam","ram","yam","bad","dad","had","mad","sad","by","my","all","or","mom","and","us","bus","bed","red","get","let","jet","net","pet","wet","den","hen","pen","ten","beg","leg","peg","it","bit","fit","hit","sit","big","dig","fig","wig","in","fin","win","pin","bid","did","hid","rid","if","is","his","her","hip","sip","tip","lip","hop","mop","pop","top","dot","got","hot","not","pot","job","mob","sob","bun","fun","run","sun","but","cut","gut","nut","up","cup","pup","cub","rub","tub","bug","dug","hug","rug","tug","zoo","be","he","bee","see","she","we","go","so","do","zen","zap","zip","zig","zag","yak","yay","yep","yet","elk","god","imp","kill","kit","kiss","key","ork","oak","one","vex","vee"];break;case 1:case 2:f=["sound","card","barn","park","only","straw","ocean","title","shark","card","good","name","right","might","think","tight","right","push","count","line","much","work","know","years","rain","mail","wait","paint","chant","paid","goods","after","very","thing","means","blue","true","clue","glue","gold","mold","hold","help","where","great","girl","third","stage","kind","cause","hero","sift","gift","lift","soft","stack","check","time","hour","edge","built","felt","valid","zinc","zits","zone","zebra","quail","quads","quaff","quilt","yowl","yews","yank","apples","dunes","double","dunce","itches","immune","idle","jiffy","judge","jails","koala","kisses","lance","loser","lofts","lodge","gnome","north","numbs","notes","ounce","three","oval","order","onion","oaken","robber","sting","under"];break;default:return"ERROR";break}for(var d=0;d<b.length;d++){for(var e=0;e<f.length;e++){if(f[e]!=undefined&&b[d]==f[e][0]){f[e]=undefined}}}f=f.filter(function(g){return g});return f[Math.floor(Math.random()*f.length)]}function getMonster(){for(var a=0;a<currentLevel.monsters.length;a++){if(currentLevel.monsters[a].word!=undefined&&currentWord[0]==currentLevel.monsters[a].word[0]){activeMonster=currentLevel.monsters[a];return}}currentWord="";activeMonster=undefined}function wordCorrectness(){if(activeMonster!=undefined){var a=0;for(var b=0;b<currentWord.length;b++){if(activeMonster.word[b]!=undefined){if(currentWord[b]==activeMonster.word[b]){a++}else{break}}}var c=[2];c[0]=activeMonster.word.substr(0,a);c[1]=activeMonster.word.substr(a,activeMonster.word.length);if(c[1].length==0){activeMonster.hit();currentWord=""}else{currentWord=c[0]}return c}else{currentWord=""}return undefined}var monsterTickCount=50;var tickCount=0;function update(c){if(focus){if(activeScreen==ScreenEnum.Game&&currentLevel!=undefined&&currentLevel.active){while(tickTime>=tickRate){tickTime-=tickRate;for(var b=0;b<currentLevel.monsters.length;b++){if(currentLevel.monsters[b]!=undefined){currentLevel.monsters[b].update()}}if(currentLevel.data[LevelDataEnum.DIFFICULTY]>currentLevel.currentDifficulty){if(tickCount++>=monsterTickCount){tickCount-=monsterTickCount;var a=currentLevel.data[LevelDataEnum.ENEMY_LEVELS][Math.floor(Math.random()*currentLevel.data[LevelDataEnum.ENEMY_LEVELS].length)];currentLevel.currentDifficulty+=a+1;monsterTickCount=currentLevel.data[LevelDataEnum.BASE_TICKS]+(Math.floor(Math.random()*currentLevel.data[LevelDataEnum.MAX_TICKS])+1);currentLevel.addMonster(new Monster(a,Math.random()*600+100,Math.floor(Math.random()*10)+100))}}else{if(currentLevel.monsters.length==0){currentLevel.end()}}}tickTime+=c}}}function render(){ctx.imageSmoothingEnabled=false;ctx.webkitImageSmoothingEnabled=false;ctx.mozImageSmoothingEnabled=false;ctxInfo.imageSmoothingEnabled=false;ctxInfo.webkitImageSmoothingEnabled=false;ctxInfo.mozImageSmoothingEnabled=false;if(activeScreen==ScreenEnum.MainMenu){ctx.fillStyle="#000";ctx.fillRect(0,0,canvas.width,canvas.height);ctxInfo.fillStyle="white";ctxInfo.fillRect(0,0,infoCanvas.width,infoCanvas.height)}else{if(activeScreen==ScreenEnum.Game||activeScreen==ScreenEnum.Inventory||activeScreen==ScreenEnum.Store){if(currentLevel!=undefined&&currentLevel.monsters!=undefined){ctx.fillStyle="#000";ctx.fillRect(0,0,canvas.width,canvas.height);ctx.drawImage(bgObj,0,0,800,600);var b=currentLevel.monsters.slice(0);b.sort(function(d,c){return d.y-c.y});ctx.font="20pt MarkerFelt-Thin, Comic Sans MS";for(var a=0;a<b.length;a++){if(activeMonster==undefined||b[a]!=activeMonster){b[a].draw();b[a].drawWord()}}if(activeMonster!=undefined){activeMonster.draw();activeMonster.drawWord()}}if(focus){ctxInfo.fillStyle="white";ctxInfo.fillRect(0,0,infoCanvas.width,infoCanvas.height);ctxInfo.font="20pt MarkerFelt-Thin, Comic Sans MS";ctxInfo.fillStyle="#000";ctxInfo.fillText("EXP: "+player.exp,100,60);ctxInfo.fillText("$$$$: "+player.gold,500,60);ctxInfo.fillStyle="red";ctxInfo.fillRect(infoCanvas.width-75,infoCanvas.height-30,75,30);ctxInfo.fillStyle="#000";ctxInfo.font="15pt MarkerFelt-Thin, Comic Sans MS";ctxInfo.fillText("pause",infoCanvas.width-65,infoCanvas.height-10)}else{ctx.fillStyle="rgba(0, 0, 0, 0.65)";ctx.fillRect(0,0,canvas.width,canvas.height);ctxInfo.fillStyle="white";ctxInfo.fillRect(0,0,canvas.width,canvas.height);ctxInfo.font="40pt MarkerFelt-Thin, Comic Sans MS";ctxInfo.fillStyle="#000";ctxInfo.fillText("GAME PAUSED",185,57);ctxInfo.font="15pt MarkerFelt-Thin, Comic Sans MS";ctxInfo.fillStyle="blue";ctxInfo.fillText("click here to un-pause",280,80)}if(activeScreen==ScreenEnum.Inventory){ctx.font="40pt MarkerFelt-Thin, Comic Sans MS";ctx.fillStyle="#000";ctx.fillText("INVENTORY",200,200)}else{if(activeScreen==ScreenEnum.Store){ctx.font="40pt MarkerFelt-Thin, Comic Sans MS";ctx.fillStyle="#000";ctx.fillText("STORE",200,200)}}}}}function run(){update((Date.now()-time)/1000);render();time=Date.now();requestAnimationFrame(run)}var l=new Level(levels[0]);